<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Font Resize Demo - Ghostty WASM</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .subtitle {
        opacity: 0.8;
        font-size: 1rem;
      }

      .demo-section {
        background: #1e1e1e;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .controls {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 20px;
        align-items: center;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #2d2d2d;
        padding: 10px 15px;
        border-radius: 8px;
      }

      .control-group label {
        color: #aaa;
        font-size: 13px;
        min-width: 80px;
      }

      .control-group input[type='range'] {
        width: 150px;
        cursor: pointer;
      }

      .control-group select {
        padding: 5px 10px;
        border-radius: 4px;
        border: 1px solid #444;
        background: #333;
        color: #fff;
        font-size: 13px;
      }

      .value-display {
        color: #4fc3f7;
        font-weight: bold;
        min-width: 40px;
        text-align: right;
        font-family: monospace;
      }

      button {
        background: #4fc3f7;
        color: #1a1a2e;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.2s;
      }

      button:hover {
        background: #29b6f6;
        transform: translateY(-1px);
      }

      button.secondary {
        background: #555;
        color: #fff;
      }

      button.secondary:hover {
        background: #666;
      }

      .terminal-wrapper {
        background: #0d0d0d;
        border-radius: 8px;
        padding: 15px;
        overflow: hidden;
      }

      #terminal-container {
        min-height: 400px;
      }

      .info-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .info-item {
        background: #2d2d2d;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .info-item .label {
        color: #888;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
      }

      .info-item .value {
        color: #4fc3f7;
        font-size: 24px;
        font-weight: bold;
        font-family: monospace;
      }

      .info-item .unit {
        color: #666;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ðŸ”¤ Dynamic Font Resize Demo</h1>
        <p class="subtitle">Test runtime font size and family changes</p>
      </header>

      <div class="demo-section">
        <div class="controls">
          <div class="control-group">
            <label>Font Size:</label>
            <input type="range" id="font-size" min="8" max="32" value="14" />
            <span class="value-display" id="font-size-value">14px</span>
          </div>

          <div class="control-group">
            <label>Font Family:</label>
            <select id="font-family">
              <option value="Monaco, Menlo, monospace">Monaco/Menlo</option>
              <option value="Courier New, monospace">Courier New</option>
              <option value="Consolas, monospace">Consolas</option>
              <option value="JetBrains Mono, monospace">JetBrains Mono</option>
              <option value="Fira Code, monospace">Fira Code</option>
              <option value="monospace">System Monospace</option>
            </select>
          </div>

          <button onclick="resetFont()">Reset</button>
          <button class="secondary" onclick="refitTerminal()">Refit to Container</button>
          <button class="secondary" onclick="showTestPattern()">Show Test Pattern</button>
        </div>

        <div class="terminal-wrapper">
          <div id="terminal-container"></div>
        </div>

        <div class="info-panel">
          <div class="info-item">
            <div class="label">Columns</div>
            <div class="value" id="info-cols">-</div>
          </div>
          <div class="info-item">
            <div class="label">Rows</div>
            <div class="value" id="info-rows">-</div>
          </div>
          <div class="info-item">
            <div class="label">Cell Width</div>
            <div class="value" id="info-cell-width">-</div>
            <div class="unit">px</div>
          </div>
          <div class="info-item">
            <div class="label">Cell Height</div>
            <div class="value" id="info-cell-height">-</div>
            <div class="unit">px</div>
          </div>
          <div class="info-item">
            <div class="label">Canvas Width</div>
            <div class="value" id="info-canvas-width">-</div>
            <div class="unit">px</div>
          </div>
          <div class="info-item">
            <div class="label">Canvas Height</div>
            <div class="value" id="info-canvas-height">-</div>
            <div class="unit">px</div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { init, Terminal } from '../lib/index.ts';
      import { FitAddon } from '../lib/addons/fit.ts';

      let term;
      let fitAddon;

      // =========================================================================
      // Initialization
      // =========================================================================

      async function initApp() {
        try {
          await init();

          term = new Terminal({
            cols: 80,
            rows: 24,
            theme: {
              background: '#0d0d0d',
              foreground: '#e0e0e0',
              cursor: '#4fc3f7',
            },
            fontFamily: 'Monaco, Menlo, monospace',
            fontSize: 14,
            cursorBlink: true,
            scrollback: 1000,
          });

          fitAddon = new FitAddon();
          term.loadAddon(fitAddon);

          const container = document.getElementById('terminal-container');
          term.open(container);

          // Don't auto-fit initially so we can see exact dimensions
          updateInfo();
          showWelcome();

          // Setup controls
          setupControls();

          // Expose for debugging
          window.term = term;
          window.fitAddon = fitAddon;
        } catch (error) {
          console.error('Failed to initialize terminal:', error);
        }
      }

      // =========================================================================
      // Control Setup
      // =========================================================================

      function setupControls() {
        const fontSizeSlider = document.getElementById('font-size');
        const fontSizeValue = document.getElementById('font-size-value');
        const fontFamilySelect = document.getElementById('font-family');

        fontSizeSlider.addEventListener('input', (e) => {
          const size = parseInt(e.target.value, 10);
          fontSizeValue.textContent = `${size}px`;
          term.options.fontSize = size;
          updateInfo();
        });

        fontFamilySelect.addEventListener('change', (e) => {
          term.options.fontFamily = e.target.value;
          updateInfo();
        });
      }

      // =========================================================================
      // Actions
      // =========================================================================

      window.resetFont = function () {
        document.getElementById('font-size').value = 14;
        document.getElementById('font-size-value').textContent = '14px';
        document.getElementById('font-family').value = 'Monaco, Menlo, monospace';

        term.options.fontSize = 14;
        term.options.fontFamily = 'Monaco, Menlo, monospace';
        updateInfo();
      };

      window.refitTerminal = function () {
        fitAddon.fit();
        updateInfo();
        term.write('\r\n\x1b[33m[Refitted to container]\x1b[0m\r\n');
      };

      window.showTestPattern = function () {
        term.clear();

        // Ruler line
        const ruler = '0123456789'.repeat(10);
        term.write(`\x1b[90m${ruler.substring(0, term.cols)}\x1b[0m\r\n`);

        // Column numbers (tens)
        let tens = '';
        for (let i = 0; i < term.cols; i++) {
          tens += Math.floor(i / 10) % 10;
        }
        term.write(`\x1b[36m${tens}\x1b[0m\r\n`);

        // Box drawing test
        term.write('\r\n\x1b[1;35mâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\x1b[0m\r\n');
        term.write('\x1b[1;35mâ”‚\x1b[0m  Font Resize Test Pattern           \x1b[1;35mâ”‚\x1b[0m\r\n');
        term.write('\x1b[1;35mâ”‚\x1b[0m                                     \x1b[1;35mâ”‚\x1b[0m\r\n');
        term.write(
          `\x1b[1;35mâ”‚\x1b[0m  Cols: \x1b[33m${term.cols.toString().padEnd(4)}\x1b[0m  Rows: \x1b[33m${term.rows.toString().padEnd(4)}\x1b[0m         \x1b[1;35mâ”‚\x1b[0m\r\n`
        );
        term.write(
          `\x1b[1;35mâ”‚\x1b[0m  Font: \x1b[33m${term.options.fontSize}px\x1b[0m                       \x1b[1;35mâ”‚\x1b[0m\r\n`
        );
        term.write('\x1b[1;35mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\x1b[0m\r\n');

        // Color bars
        term.write('\r\n');
        for (let i = 0; i < 8; i++) {
          term.write(`\x1b[4${i}m   \x1b[0m`);
        }
        term.write('\r\n');
        for (let i = 0; i < 8; i++) {
          term.write(`\x1b[10${i}m   \x1b[0m`);
        }
        term.write('\r\n\r\n');

        // Sample text at different styles
        term.write(
          '\x1b[1mBold\x1b[0m \x1b[3mItalic\x1b[0m \x1b[4mUnderline\x1b[0m \x1b[1;3;4mAll\x1b[0m\r\n'
        );
        term.write('ABCDEFGHIJKLMNOPQRSTUVWXYZ\r\n');
        term.write('abcdefghijklmnopqrstuvwxyz\r\n');
        term.write('0123456789 !@#$%^&*()_+-=\r\n');
      };

      // =========================================================================
      // Info Updates
      // =========================================================================

      function updateInfo() {
        document.getElementById('info-cols').textContent = term.cols;
        document.getElementById('info-rows').textContent = term.rows;

        // Get metrics from renderer
        if (term.renderer) {
          const metrics = term.renderer.getMetrics();
          document.getElementById('info-cell-width').textContent = metrics.width.toFixed(1);
          document.getElementById('info-cell-height').textContent = metrics.height.toFixed(1);

          const canvas = term.renderer.getCanvas();
          document.getElementById('info-canvas-width').textContent = parseInt(canvas.style.width);
          document.getElementById('info-canvas-height').textContent = parseInt(canvas.style.height);
        }
      }

      // =========================================================================
      // Welcome Message
      // =========================================================================

      function showWelcome() {
        term.write(
          '\x1b[1;36mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\x1b[0m\r\n'
        );
        term.write(
          '\x1b[1;36mâ•‘\x1b[0m              \x1b[1;33mðŸ”¤ Dynamic Font Resize Demo\x1b[0m                           \x1b[1;36mâ•‘\x1b[0m\r\n'
        );
        term.write(
          '\x1b[1;36mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m\r\n'
        );
        term.write('\r\n');
        term.write('This demo tests runtime font changes.\r\n');
        term.write('\r\n');
        term.write('\x1b[1mInstructions:\x1b[0m\r\n');
        term.write(
          '  â€¢ Drag the \x1b[33mFont Size\x1b[0m slider to change font size dynamically\r\n'
        );
        term.write('  â€¢ Select a different \x1b[33mFont Family\x1b[0m from the dropdown\r\n');
        term.write('  â€¢ Click \x1b[33mRefit to Container\x1b[0m to recalculate cols/rows\r\n');
        term.write('  â€¢ Click \x1b[33mShow Test Pattern\x1b[0m for alignment verification\r\n');
        term.write('\r\n');
        term.write('\x1b[1mExpected behavior:\x1b[0m\r\n');
        term.write('  â€¢ Font changes should update immediately\r\n');
        term.write('  â€¢ Cols/rows stay constant (canvas resizes)\r\n');
        term.write('  â€¢ Use "Refit" to adjust grid to container\r\n');
        term.write('\r\n');
        term.write(
          '\x1b[90mTip: Open console, `term` and `fitAddon` are exposed globally\x1b[0m\r\n'
        );
      }

      // Initialize
      initApp();
    </script>
  </body>
</html>
